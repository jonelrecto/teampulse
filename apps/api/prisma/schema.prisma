generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model CheckIn {
  id                String              @id
  userId            String
  teamId            String
  yesterday         String
  today             String
  blockers          String?
  mood              Mood
  energy            Int
  checkInDate       DateTime            @db.Date
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  Team              Team                @relation(fields: [teamId], references: [id], onDelete: Cascade)
  Users             Users               @relation(fields: [userId], references: [id], onDelete: Cascade)
  CheckInAttachment CheckInAttachment[]

  @@unique([userId, teamId, checkInDate])
  @@index([teamId, checkInDate])
  @@index([userId])
}

model CheckInAttachment {
  id          String   @id
  checkInId   String
  url         String
  filename    String
  storagePath String
  createdAt   DateTime @default(now())
  CheckIn     CheckIn  @relation(fields: [checkInId], references: [id], onDelete: Cascade)

  @@index([checkInId])
}

model Notification {
  id        String    @id
  userId    String
  type      String
  title     String
  body      String
  readAt    DateTime?
  createdAt DateTime  @default(now())
  Users     Users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, readAt])
}

model NotificationPreference {
  id              String          @id
  userId          String
  teamId          String
  reminderEnabled Boolean         @default(true)
  reminderTime    String          @default("09:00")
  digestFrequency DigestFrequency @default(DAILY)
  Users           Users           @relation(fields: [userId], references: [id], onDelete: Cascade)
  Team           Team             @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([userId, teamId])
  @@index([userId])
}

model Team {
  id             String           @id
  name           String
  logoUrl        String?
  inviteCode     String           @unique
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  CheckIn        CheckIn[]
  TeamMembership TeamMembership[]
  NotificationPreference NotificationPreference[]
}

model TeamMembership {
  id       String   @id
  userId   String
  teamId   String
  role     TeamRole @default(MEMBER)
  joinedAt DateTime @default(now())
  Team     Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  Users    Users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, teamId])
  @@index([teamId])
  @@index([userId])
}

model Users {
  id                     String                   @id(map: "User_pkey")
  supabaseId             String                   @unique(map: "User_supabaseId_key")
  email                  String                   @unique(map: "User_email_key")
  displayName            String
  avatarUrl              String?
  timezone               String                   @default("America/New_York")
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @default(now())
  CheckIn                CheckIn[]
  Notification           Notification[]
  NotificationPreference NotificationPreference[]
  TeamMembership         TeamMembership[]
}

enum Mood {
  GREAT
  GOOD
  OKAY
  LOW
  STRUGGLING
}

enum DigestFrequency {
  OFF
  DAILY
  WEEKLY
}

enum TeamRole {
  ADMIN
  MEMBER
}
